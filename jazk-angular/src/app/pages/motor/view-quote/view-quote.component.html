<app-header></app-header>

<div
    class="mb-3 mt-3"
    *ngIf="
      parseService.fetching || parseService.saving || parseService.deleting
    "
  >
    <div class="progress">
      <div class="progress-bar progress-bar-indeterminate bg-green"></div>
    </div>
  </div>

<div class="page-wrapper">
  <div class="page-body">
    <div class="container-xl">
      <div class="container" *ngIf="
          motorService.motorQuotation && motorService.motorQuotation.makeModel
        ">
        <div class="row">
          <div class="col-lg-8 offset-lg-2">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Summary Quotation</h3>
              </div>
              <div class="card-body">
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label class="form-label fw-bolder text-center text-decoration-underline mb-5">Rating Factors</label>
                    <p class="row px-1">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Make & Model:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">{{ motorService.motorQuotation.makeModel }}</span>
                    </p>
                    <p class="row px-1">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Year of Manufacture:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">{{ motorService.motorQuotation.yearOfManufacture }}</span>
                    </p>
                    <p class="row px-1">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Vehicle Age:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">{{ motorService.motorQuotation.vehicleAge }}</span>
                    </p>
                    <p class="row px-1">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Vehicle Value:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">Kshs.{{ motorService.motorQuotation.sumInsured | number }}</span>
                    </p>
                    <p class="row px-1">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Motor Class:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">{{ motorService.motorQuotation.motorClass | titlecase }}</span>
                    </p>
                    <p class="row px-1" *ngIf=" motorService.motorQuotation.motorSubclass != '' ">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Class Name:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">{{ motorService.motorQuotation.motorSubclass | titlecase }}</span>
                    </p>
                    <p class="row px-1">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Basic Premium:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold custom-bg-grey">Kshs.{{ motorService.motorQuotation.basicPremium | number }}</span>
                    </p>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label fw-bolder text-center text-decoration-underline mb-5">Additional Benefits</label>
                    <p class="row px-1" *ngIf="motorService.motorQuotation.pvtBenefit != 0">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Political Violence Terrorism:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">Kshs.{{ motorService.motorQuotation.pvtBenefit | number }}</span>
                    </p>
                    <p class="row px-1" *ngIf="motorService.motorQuotation.excessProtectorBenefit != 0">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Own Damage Excess Protector:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">{{ motorService.motorQuotation.excessProtectorBenefit == 'Inclusive' ? (motorService.motorQuotation.excessProtectorBenefit | titlecase) : 'Kshs.'+(motorService.motorQuotation.excessProtectorBenefit | number) }}</span>
                    </p>
                    <p class="row px-1" *ngIf="motorService.motorQuotation.passengerLegalLiabilityBenefit != 0">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Passenger Legal Liability:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">Kshs.{{ motorService.motorQuotation.passengerLegalLiabilityBenefit | number }}</span>
                    </p>
                    <p class="row px-1" *ngIf="motorService.motorQuotation.courtesyCarBenefit != 0">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Loss of Use:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">Kshs.{{ motorService.motorQuotation.courtesyCarBenefit | number }}</span>
                    </p>
                    <p class="row px-1" *ngIf="motorService.motorQuotation.windScreenBenefit != 0">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Additional Wind screen limit (Above {{ motorService.motorQuotation.sumInsured <= 2500000 ? '50k'  : '100k' }}):</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">Kshs.{{ motorService.motorQuotation.windScreenBenefit | number }}</span>
                    </p>
                    <p class="row px-1" *ngIf="motorService.motorQuotation.radioCassetteBenefit != 0">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Additional Radio Cassette limit (Above {{ motorService.motorQuotation.sumInsured <= 2500000 ? '50k'  : '100k' }}):</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">Kshs.{{ motorService.motorQuotation.radioCassetteBenefit | number }}</span>
                    </p>
                    <label class="form-label fw-bolder text-center text-decoration-underline mb-5">Gross Premium</label>
                    <p class="row px-1">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>JAZ-Assist:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">Inclusive</span>
                    </p>
                    <p class="row px-1">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Net Premium:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold custom-bg-grey">Kshs.{{ motorService.motorQuotation.netPremium | number }}</span>
                    </p>
                    <p class="row px-1" *ngIf="motorService.motorQuotation.aaRoadRescueBenefit != 0">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>AA Road Rescue:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold">Kshs.{{ motorService.motorQuotation.aaRoadRescueBenefit | number }}</span>
                    </p>
                    <p class="row px-1">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Levies:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold"> Kshs. {{ motorService.motorQuotation.levies | number }}</span>
                    </p>
                    <p class="row px-1">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Stamp Duty:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold"> Kshs. {{ motorService.motorQuotation.stampDuty | number }}</span>
                    </p>
                    <p class="row px-1">
                      <span class="m-0 p-0 col-md-7 col-sm-6 col-6"><strong>Gross Premium:</strong></span>
                      <span class="m-0 p-0 col-md-5 col-sm-6 col-6 fw-bold custom-bg"> Kshs. {{ motorService.motorQuotation.grossPremium | number }}</span>
                    </p>
                  </div>
                </div>

                <!-- <div class="row mb-3">
                  <div class="col-md-6">
                    <h4>Limits of Liabilities</h4>
                    <ul>
                      <li>
                        <strong>Third Party Property Damage:</strong> KES
                        {{ insurance.limits.thirdPartyPropertyDamage | number }}
                      </li>
                      <li>
                        <strong>Bodily Injury per Person:</strong> KES
                        {{ insurance.limits.bodilyInjuryPerPerson | number }}
                      </li>
                      <li>
                        <strong>Bodily Injury per Accident:</strong> KES
                        {{ insurance.limits.bodilyInjuryPerAccident | number }}
                      </li>
                    </ul>
                  </div>
                  <div class="col-md-6">
                    <h4>Excesses</h4>
                    <ul>
                      <li>
                        <strong>Own Damage:</strong>
                        {{ insurance.excesses.ownDamage }}%
                      </li>
                      <li>
                        <strong>Theft:</strong> {{ insurance.excesses.theft }}%
                      </li>
                      <li>
                        <strong>Windscreen Damage:</strong>
                        {{ insurance.excesses.windscreenDamage }}%
                      </li>
                    </ul>
                  </div>
                </div> -->
              </div>
              <div class="card-footer">
                <div class="row">
                  <div class="col-lg-3 mb-3">
                    <button class="btn btn-primary" (click)="purchase()">
                      Purchase Insurance
                    </button>
                  </div>
                  <div class="col-lg-3 mb-3">
                    <button class="btn btn-primary" (click)="actionType = 'Download'" data-bs-toggle="modal"
                      data-bs-target="#modal-email-quote">
                      Download Quote &nbsp;
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-download" width="44"
                        height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2" />
                        <path d="M7 11l5 5l5 -5" />
                        <path d="M12 4l0 12" />
                      </svg>
                    </button>
                  </div>
                  <div class="col-lg-3 mb-3">
                    <button class="btn btn-primary" (click)="actionType = 'Email'" data-bs-toggle="modal"
                      data-bs-target="#modal-email-quote">
                      Email Quote &nbsp;
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-message-forward"
                        width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path
                          d="M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12z" />
                        <path d="M13 8l3 3l-3 3" />
                        <path d="M16 11h-8" />
                      </svg>
                    </button>
                  </div>
                  <!-- <div class="col-lg-3 mb-3">
                    <button class="btn btn-secondary" (click)="goBack()">Go Back</button>
                  </div> -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="mb-3 mt-3" *ngIf="
          parseService.fetching || parseService.saving || parseService.deleting
        ">
        <div class="progress">
          <div class="progress-bar progress-bar-indeterminate bg-green"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal modal-blur" id="modal-email-quote" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <form [formGroup]="clientForm" (ngSubmit)="onSubmitEmailDownload()">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ actionType }} Quote</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <p class="row px-1">Please provide the details to proceed</p>
          </div>

          <div class="row">
            <div class="col-lg-8">
              <div class="mb-3">
                <label class="form-label">Client Name</label>
                <input type="text" class="form-control" formControlName="name" [(ngModel)]="emailQuoteDetails.name"
                  placeholder="Client Name" />
              </div>
              <div *ngIf="clientName.invalid && parseService.submitting" class="alert alert-danger">
                <div *ngIf="clientName.errors?.['required']">
                  Name is required.
                </div>
              </div>
            </div>
            <div class="col-lg-8">
              <div class="mb-3">
                <label class="form-label">Client Phone</label>
                <div class="input-group">
                  <span class="input-group-text">+254</span>
                  <input class="form-control" formControlName="phone" placeholder="Enter Phone Number"
                    [(ngModel)]="emailQuoteDetails.phone" />
                </div>
              </div>
              <div *ngIf="clientPhone.invalid && parseService.submitting" class="alert alert-danger">
                <div *ngIf="clientPhone.errors?.['required']">
                  Phone is required.
                </div>
              </div>
            </div>
            <div class="col-lg-8">
              <div class="mb-3">
                <label class="form-label">Client Email</label>
                <input type="text" class="form-control" formControlName="email" [(ngModel)]="emailQuoteDetails.email"
                  placeholder="Client Email" />
              </div>
              <div *ngIf="clientEmail.invalid && parseService.submitting" class="alert alert-danger">
                <div *ngIf="clientEmail.errors?.['required']">
                  Email is required.
                </div>
              </div>
            </div>
            <div class="col-lg-8">
              <div class="mb-3">
                <label class="form-label">Vehicle Registration Number</label>
                <input type="text" class="form-control" formControlName="registrationNumber"
                  [(ngModel)]="emailQuoteDetails.registrationNumber" placeholder="Registration Number" />
              </div>
              <div *ngIf="registrationNumber.invalid && parseService.submitting" class="alert alert-danger">
                <div *ngIf="registrationNumber.errors?.['required']">
                  Registration Number is required.
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <a href="#" class="btn btn-link link-secondary" data-bs-dismiss="modal">
            Cancel
          </a>
          <button type="submit" [disabled]="parseService.saving" class="btn btn-primary ms-auto"
            data-bs-dismiss="modal">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
              <path d="M12 5l0 14"></path>
              <path d="M5 12l14 0"></path>
            </svg>
            Submit
          </button>
        </div>
      </div>
    </form>
  </div>
</div>